window._CerMent={hostName:"segment.p24.hu",sourcePath:"/source/",commFrameHost:"segment.p24.hu",commFramePath:"/commHost.html",mainStorageKey:"cerment",mappingsStorageKey:"m",segmentsStorageKey:"s",segmentValid:2592e3,segmentMaxSize:100,mappingValid:21600,sources:{comm:["ru_mapping_simplified"],cont:[]},segmentIds:{comm:{ru:{arts:"211538",auto:"211522",baby:"395664",business:"211544",christmas:"395666",dating:"395668",entertainment:"211510",family:"211546",fashion:"211550",food:"211536",front:"395632",gaming:"211542",health:"211512",home:"211552",lifestyle:"211520",men:"211524",news:"211508",shopping:"395670",sports:"211526",tech:"211554",television:"211548",travel:"211540"}},cont:{}},pathElementsMoreDetailed:["tag","hirdetesek"],pathElementsProhibited:["Fooldal"],readOnly:{comm:!1,cont:!1},segmentSeparator:";",mappings:{comm:{},cont:{}},browserActivity:{comm:{},cont:{}},currentUrl:"",currentSegments:[],canUseLocalStorage:!0,documentProtocol:"http",presetState:{mappings:!1,segments:!1},go:function(){"object"!=typeof localStorage&&(this.canUseLocalStorage=!1),"https:"==window.location.protocol&&(this.documentProtocol="https"),this.crossDomainStorage.parent=this,this.crossDomainStorage.init();var t=window.location.pathname.replace(new RegExp(this.pathElementsProhibited.join("|"),"g"),"").replace(/[\/]{2,}/g,"/").substr(1).split("/");this.currentUrl=window.location.host.replace("www.","")+"/",""!=t[0]&&(this.currentUrl+=t[0]+"/",-1!=this.pathElementsMoreDetailed.indexOf(t[0])&&(this.currentUrl+=t[1]+"/")),this.crossDomainStorage.getValue(this.mainStorageKey+"_"+this.mappingsStorageKey,this.processMessage),this.crossDomainStorage.getValue(this.mainStorageKey+"_"+this.segmentsStorageKey,this.processMessage),"undefined"!=typeof document.addEventListener?document.addEventListener("click",this.linkClickListener):document.attachEvent("onclick",this.linkClickListener)},emptyMappings:function(){this.mappings={comm:{},cont:{}}},processMessage:function(t,e,i){switch(i){case"set":if("OK"!==e)throw new Error("CER00500");break;case"get":switch(t){case this.mainStorageKey+"_"+this.mappingsStorageKey:this.mappings=JSON.parse(e)||this.mappings,"undefined"==typeof this.mappings.ts||this.getCurrentTimestamp()-this.mappings.ts>this.mappingValid?(this.emptyMappings(),this.getSources()):this.mappingReady(!0);break;case this.mainStorageKey+"_"+this.segmentsStorageKey:this.browserActivity=JSON.parse(e)||this.browserActivity,this.cleanActivities()}}},cleanActivities:function(){var t=this.getCurrentTimestamp();for(var e in this.browserActivity)if(this.browserActivity.hasOwnProperty(e))for(var i in this.browserActivity[e])if(this.browserActivity[e].hasOwnProperty(i)){this.browserActivity[e][i].length>this.segmentMaxSize&&(this.browserActivity[e][i]=this.browserActivity[e][i].sort().slice(0,this.segmentMaxSize));for(var s=0;s<this.browserActivity[e][i].length;s++)t-this.browserActivity[e][i][s]>this.segmentValid&&this.browserActivity[e][i].splice(s,1);if(0==this.browserActivity[e][i].length){this.browserActivity[e][i]=void 0;try{delete this.browserActivity[e][i]}catch(n){}}}this.presetState.segments=!0,this.presetsReady()},getSources:function(){if(0==this.sources.comm.length&&0==this.sources.cont.length)this.mappingReady();else for(var t in this.sources)this.sources.hasOwnProperty(t)&&this.sources[t].length>0&&this.getJson(this.documentProtocol+"://"+this.hostName+this.sourcePath+this.sources[t].pop()+".js",this.processJsonResponse,t)},getJson:function(t,e,i){var s=document.createElement("SCRIPT"),n=document.getElementsByTagName("head")[0]||document.documentElement;s.onload=function(){n.removeChild(s),"object"==typeof mapping&&(e.apply(window._CerMent,[mapping,i]),mapping=void 0)},s.src=t,n.appendChild(s)},processJsonResponse:function(t,e){for(var i in t)t.hasOwnProperty(i)&&("undefined"!=typeof this.mappings[e][i]?this.mappings[e][i]=this.mappings[e][i].concat(t[i]):this.mappings[e][i]=t[i]);this.getSources()},mappingReady:function(t){t=t||!1,t===!1&&(this.mappings.ts=this.getCurrentTimestamp(),this.crossDomainStorage.setValue(this.mainStorageKey+"_"+this.mappingsStorageKey,JSON.stringify(this.mappings),this.processMessage)),this.presetState.mappings=!0,this.presetsReady()},presetsReady:function(){this.presetState.mappings===!0&&this.presetState.segments===!0&&this.processUrl()},processUrl:function(){for(var t in this.mappings)if(this.mappings.hasOwnProperty(t))for(var e in this.mappings[t])if(this.mappings[t].hasOwnProperty(e)&&this.currentUrl==e)for(var i=0;i<this.mappings[t][e].length;i++)"undefined"==typeof this.browserActivity[t][this.mappings[t][e][i]]&&(this.browserActivity[t][this.mappings[t][e][i]]=[]),this.browserActivity[t][this.mappings[t][e][i]].push(this.getCurrentTimestamp()),this.currentSegments.push(this.mappings[t][e][i]);this.isEmptyObject(this.browserActivity)===!1&&this.crossDomainStorage.setValue(this.mainStorageKey+"_"+this.segmentsStorageKey,JSON.stringify(this.browserActivity)),this.deliverSegments()},processClickedElement:function(t){var e=this.digForAttribute(t);if(null!==e){for(var i=e.replace(/ /g,"").split(this.segmentSeparator),s=0;s<i.length;s++)""!=i[s]&&("undefined"==typeof this.browserActivity.cont[i[s]]&&(this.browserActivity.cont[i[s]]=[]),this.browserActivity.cont[i[s]].push(this.getCurrentTimestamp()));this.crossDomainStorage.setValue(this.mainStorageKey+"_"+this.segmentsStorageKey,JSON.stringify(this.browserActivity)),this.readOnly.cont===!1&&this.refreshSegmentsInContext("cont")}},digForAttribute:function(t,e){var i=null;return e=e||0,3>e&&(e++,i=null!==t.getAttribute("data-con-cat")?t.getAttribute("data-con-cat"):this.digForAttribute(t.parentNode,e)),i},linkClickListener:function(t){"a"===t.target.tagName.toLowerCase()&&window._CerMent.processClickedElement.apply(window._CerMent,[t.target])},deliverSegments:function(){var t=[],e=[],i=[],s=document.getElementsByTagName("head")[0]||document.documentElement,n=document.getElementsByTagName("body")[0]||document.documentElement;if(this.readOnly.comm===!1){void 0==centralContext.ba&&(centralContext.ba={cont:{},comm:""}),centralContext.ba.comm=this.currentSegments.join();for(var r=0;r<this.currentSegments.length;r++)i.push({type:"IMG",src:"//pixel.rubiconproject.com/tap.php?v="+this.segmentIds.comm.ru[this.currentSegments[r]],params:{border:0,width:1,height:1}})}if(this.readOnly.cont===!1&&(void 0==centralContext.ba&&(centralContext.ba={cont:{},comm:""}),this.refreshSegmentsInContext("cont")),t.length>0){var o=document.createElement("SCRIPT");o.innerHTML="\n";for(var r=0;r<t.length;r++)o.innerHTML+=t[r]+"\n";s.appendChild(o)}if(e.length>0)for(var r=0;r<e.length;r++){var a=document.createElement("meta");a.name=e[r].name,a.content=e[r].content,s.appendChild(a)}if(i.length>0)for(var r=0;r<i.length;r++){var h=document.createElement(i[r].type);if(h.src=i[r].src,"object"==typeof i[r].params&&i[r].length>0)for(var c in i[r].params)i[r].params.hasOwnProperty(c)&&h.setAttribute(c,i[r].params[c]);n.appendChild(h)}},refreshSegmentsInContext:function(t){if("cont"==t)for(var e in this.browserActivity.cont)this.browserActivity.cont.hasOwnProperty(e)&&(centralContext.ba.cont[e]=this.browserActivity.cont[e].length)},isEmptyObject:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},getCurrentTimestamp:function(){return Math.round((new Date).getTime()/1e3)},crossDomainStorage:{parent:null,_iframe:null,_iframeReady:!1,_queue:[],_requests:{},_id:0,init:function(){var t=this;if(!this._iframe){if(!(window.postMessage&&window.JSON&&window.localStorage))throw new Error("Unsupported browser.");this._iframe=document.createElement("iframe"),this._iframe.style.cssText="position:absolute;width:1px;height:1px;left:-9999px;",document.body.appendChild(this._iframe),window.addEventListener?(this._iframe.addEventListener("load",function(){t._iframeLoaded()},!1),window.addEventListener("message",function(e){t._handleMessage(e)},!1)):this._iframe.attachEvent&&(this._iframe.attachEvent("onload",function(){t._iframeLoaded()},!1),window.attachEvent("onmessage",function(e){t._handleMessage(e)}))}this._iframe.src=this.parent.documentProtocol+"://"+this.parent.commFrameHost+this.parent.commFramePath},getValue:function(t,e){var i={key:t,id:++this._id},s={request:i,callback:e};this._iframeReady?this._sendRequest(s):this._queue.push(s),this._iframe||this.init()},setValue:function(t,e,i){var s={key:t,val:e,id:++this._id},n={request:s,callback:i};this._iframeReady?this._sendRequest(n):this._queue.push(n),this._iframe||this.init()},_sendRequest:function(t){this._requests[t.request.id]=t,this._iframe.contentWindow.postMessage(JSON.stringify(t.request),this.parent.documentProtocol+"://"+this.parent.commFrameHost)},_iframeLoaded:function(){if(this._iframeReady=!0,this._queue.length){for(var t=0,e=this._queue.length;e>t;t++)this._sendRequest(this._queue[t]);this._queue=[]}},_handleMessage:function(t){if(t.origin==this.parent.documentProtocol+"://"+this.parent.commFrameHost){var e=JSON.parse(t.data);"undefined"!=typeof this._requests[e.id].callback&&"undefined"!=typeof e.value&&this._requests[e.id].callback.apply(window._CerMent,[e.key,e.value,e.type]),delete this._requests[e.id]}}}};var centralContext=centralContext||{};window._CerMent.go();